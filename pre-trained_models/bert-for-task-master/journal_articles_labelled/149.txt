result provide comprehensive atlas hostgut microbe response bariatric surgery weightloss glycaemic control system level find minimal overlap metabolite associate body mass index bmi associate glycaemic control consistent weightindependent mechanism t2d resolution establish multiple association gut microbiota host metabolite however experiment require provide mechanistic insight role gut microbiota host metabolism establish proof causality patient refer consideration bariatric surgery obese bmi 30 kgm age ≥ 18 fail effort lifestyle modification diet will comply trial protocol recruit prospectively observational study volunteer provide write consent volunteer type 2 diabetes hba1c ≥ 48 mmolmol treat impair glucose tolerance hba1c 4247 mmolmol without diabetes eligible recruitment patient previously undergo bariatric major abdominal surgery intend become pregnant trial period take longterm antibiotic exclude major abdominal surgery include patient undergo small large bowel resection liver pancreatic splenic stomach surgery could influence gut microbiota andor patient 's metabolic state patient previously appendicectomy cholecystectomy hernia repair exclude study protocol sample collection instruction codeveloped patient representative help reduce study burden patient improve patient compliance sample collection occur time patient usual hospital appointment preoperatively 3months postprocedure small exploratory cohort also sample 1year postprocedure report supplementary fig 49 supplementary table 68 supplementary data 68. participant undergo rouxeny gastric bypass rygb vertical sleeve gastrectomy vsg surgery national health service nh university teach hospital london uk single dose 1.2 g intravenous coamoxiclav give induction anaesthesia clindamycin penicillin allergic see supplementary note 1 detail perioperative dietary advice give surgical technique use study receive nh research ethic committee 15es0026 approval register clinicaltrials.gov nct02421055 participant assess time point 1 anthropometric physiological measurement 2 demographic detail 3 biochemical parameter include glycated haemoglobin hba1c 4 oralhypoglycaemic insulin medication use length diabetes diagnosis comorbidities online selfreported 24hour dietary recall questionnaire www.myfood24.org utilise capture detail dietary intake information patient study time point change diet follow surgery could account analysis three 24hour recall questionnaire complete time point participant able pick selection picture correspond food accurately ascertain portion quantity collect dietary information use calculate alternative healthy eat index 2010 ahei2010 score describe previously brief score 010 give 11 component maximum score 110. high score give high intake vegetable fruit nut legume whole grain long chain omega3 fat polyunsaturated fat moderate intake alcohol low intake sugar sweeten drink fruit juice red process meat transfat sodium serum n 156 faecal n 80 24 h urine n 83 sample collect preoperatively 3months postoperatively serum 49 faecal 27 urine 30 nonfasted state see supplementary fig 1. urine sample collect sterile container 24hour period finish 9am day study visit stool sample collect use faecotainer03 collection kit store ice pack provide close possible 6 h study visit serum collect use red top bd vacutainer03 serum tube additive process accord manufacturer guideline collection sample aliquoted store 80 °c analysis prior freeze separate aliquot homogenise stool use generate faecal water follow approximately 10 g stool add 4 part hplc grade ho gml vortexed 2850 rpm 15 min centrifuge 10,000 × g 15 min 4 °c result supernatant faecal water freeze 80 °c analysis urine faecal water sample prepare analysis hnmr spectroscopy follow freeze sample 80 °c thaw vortexed centrifuge 1600 × g 10 min remove particulate precipitate protein faecal water supernatant filter micro centrifuge filter 0.45 08m nylon costar 16,000 × g 15 min 4 °c 540 μl sample mix 60 μl 1.5 khpo buffer ph 7.4 80 contain 1 mm internal reference standard 3trimethylsilyl2,2,3,3 hpropionic acid tsp 2 mm sodium azide nan describe previously thaw serum sample centrifuge 12,000 × g 5 min 4 °c subsequently 300 08l serum mix 300 08l 0.075 nahpo buffer ph 7.4 contain 0.8 mm internal reference standard 3trimethylsilyl2,2,3,3 hpropionic acid tsp 3.1 mm sodium azide nan describe previously hnmr spectroscopy perform 300 k bruker 600 mhz urine serum 800 mhz faecal water spectrometer bruker biospin use follow standard onedimensional pulse sequence rd g 90° 90° g 90° acq relaxation delay rd set 4 90° represent apply 90° radio frequency pulse interpulse delay set interval 4 μs mix time tm 10 m magnetic field gradient g g apply 1 m acquisition period aqa 2.7 s. water suppression achieve irradiation water signal rd t. urine sample spectrum acquire use 4 dummy scan follow 32 scan faecal spectrum acquire use 256 scan 4 dummy scan collect 64 k data point spectral width 12,000 hz use sample prior fourier transformation free induction decay fids multiply exponential function correspond line broaden 0.3 hz serum sample analyse hnmr spectroscopy use standard onedimensional pulse sequence describe carrpurcellmeiboomgill cpmg one dimensional pulse sequence cpmg use attenuate broad interfere peak lipid protein present serum cpmg pulse sequence form rd 90° 180° n acq acquisition parameter set use set standard 1d pulse sequence spinecho delay set 0.3 m 128 loop n perform continuous wave irradiation apply water resonance frequency relaxation delay rd hnmr spectrum automatically correct phase baseline distortion reference tsp singlet δ 0.0 use topspin 3.1 software spectrum digitize 20 k data point resolution 0.0005 ppm use inhouse matlab r2014a mathworks script subsequently spectral region correspond internal standard δ 0.5 0.5 water δ 4.65 peak remove addition region contain urea δ 5.46.3 remove urinary serum spectrum due tendency crosssaturate suppress water resonance spectrum normalise use median fold change normalisation use median spectrum reference quantitative analysis 57 bile acid perform use establish technique method adapt analysis bile acid faecal sample bile acid extract serum use follow method 100 08l serum vortexed 280 08l meoh sample centrifuge 14,000 × g 15 min 4 °c follow incubation 20 °c 20 min internal standard 16 deuterated bile acid add supernatant final concentration 50 nm bile acid extract faecal sample use follow method faecal sample first freezedried 100 mg freezedried material place microtubes 1 ml 2:1:1 ho acetonitrile acn isopropanol ipa approximately 50 mg 1 mm zirconia bead undergo 3 × 30 second bead beat biospec bead beater follow centrifugation 16,000 × g 20 min 4 °c supernatant filter microcentrifuge filter 0.45 08m nylon costar 16,000 × g 15 min 4 °c ensure bile acid concentration within dynamic range machine extract dilute 1:25 1:200 prior analysis use ho acn ipa mix mixture internal standard 16 deuterated bile acid add filter supernatant final concentration 50 nm ba analysis perform use acquity ultraperformance liquid chromatography uplc couple xevo triple quadrupole tqs mass spectrometer liquid chromatography acquity beh c8 column 1.7 μm 100 mm × 2.1 mm use operate temperature 60 °c mobile phase solvent consist 1:10 acn ho 1 mm ammonium acetate ph 4.15 adjust acetic acid mobile phase solvent b consist 1:1 acn ipa chromatographic gradient previously publish mass spectrometry perform negative ionisation mode esi use follow parameter capillary voltage 1.5 kv cone voltage 60 v source temperature 150 °c desolvation temperature 600 °c desolvation gas flow 1000 lhr cone gas flow 150 lhr 57 bile acid specie 36 nonconjugated 12 taurine conjugate 9 glycine conjugate assay use multiple reaction monitor mrm transition bile acid deuterated internal standard set previously publish total five shortmedium chain fatty acid three methylbranched scfas two hydroxyl carboxylic acid analyse gcms use method adapt moreau et al .. defrost mix 100 08l urine serum aliquoted 500 08l methyl tertbutyl ether mtbe 100ppm internal standard methyl stearate 2 08l hcl vortexed shake 20 min follow sample centrifuge 10,000 × g 5 min 4 °c next 90 08l polar phase place silanised vial vortexed 150 08l derivatiser ntertbutyldimethylsilylnmethyltrifluoroacetamide 1 tertbutyldimethylchlorosilane mtbstfa 1 tbdmsci incubate 45 min 60 °c aliquoting silanised insert analysis method modify account higher level scfa stool defrost 100 mg stool aliquoted 1,000 08l mtbe 100ppm internal standard methyl stearate 4 08l hcl 30 08l polar phase mix 150 08l derivatiser derivatised sample analyse gcms bruker triple quadrupole tq gcmsms helium use carrier gas constant flow rate 1.5 mlmin column injector temperature 250 °c split ratio 1:10. temperature oven start 40 °c increase rate 46 °cmin 127 °c 2 °cmin reach 131 °c 30 °cmin reach 160 °c 50 °cmin reach final temperature 300 °c transfer line mass spectrometer set 280 °c target analysis ten compound internal standard perform multiple reaction monitor mode mrn use set outline table 1. quantitative analysis metabolite serum sample include amino acid biogenic amine acylcarnitines phosphatidylcholines lysophosphatidylcholines sphingolipids perform use biocrates absoluteidq03 p180 kit accord manufacturer guideline sample analyse use flow injection analysis fiamsms lcmsms different metabolite group total 10 08l serum sample pb calibration qc 10 08l istd mix except blank add well dry 30 min nitrogen flow follow 50 08l derivatization solution pipetted well plate cover incubate 20 min dry 60 min nitrogen flow next 300 08l extraction solvent add well shake 30 min 450 rpm centrifuge 2 min 500 × g. lcmsms 150 08l add 150 08l ho fia 15 08l add 750 08l fia mobile phase plate shake 2 min 600 rpm sample analyse use water iclass uhplc system water xevo tqs tandem mass spectrometer fiamsms direct infusion fia mobile phase consist biocrates solvent 290 ml meoh 2 min isocratic method use start 0.15 mlmin 0.1 min gradually decrease 0.03 mlmin 1 min increase 0.2 mlmin 1.5 min 0.8 mlmin 1.60 min finally decrease 0.15 mlmin 1.95 min m set capillary voltage 3.2 kv cone voltage 10 v source offset 50 v source temp 150 °c desolvation temp 620 °c cone gas 150 lh desolvation gas 1000 lh collision gas flow 0.15 mlmin probe position 5 mm lcmsms water acquity uplc behc18 1.7 08m 2.1 x 75 mm column use mobile phase 1000 ml ho 2 ml formic acid fa mobile phase b 500 ml acn 1 ml fa gradient elution use start flow rate 0.8 mlmin 100 0.45 min change linear gradient 85 3.3 min 30 5.9 min 100 b 6.05 min flow increase concave gradient 0.9 mlmin 100 b 6.20 min remain 0.9 mlmin 100 b 6.42 min decrease back concave gradient 0.8 mlmin 100 b 6.52 min mobile phase change concave gradient 100 b 100 6.52 6.7 min remain 100 0.8 mlmin 7.3 min m set capillary voltage 3.9 kv cone voltage 20 v source offset 50 v source temp 150 °c desolvation temp 350 °c cone gas 150 lhr desolvation gas 650 lhr collision gas flow 0.15 mlmin probe position 7 mm data process use targetlynx water metidq biocrates version carbon export csv file statistical analysis faecal sample store 80 °c prior analysis dna extract use mobio powerfaecal03 dna isolation kit accord manufacturer 's instruction brief dna extract two separate 0.25 g aliquot mix whole stool sample analysis point sample homogenise 2 ml bead beat tube contain garnet bead cell lysis host microbial cell facilitate mechanical collision bead chemical disruption cell membrane reagent precipitate nondna organic inorganic material apply lastly dna capture silica spin column wash elute downstream analysis quality control dna quality quantity assess use agilent 4200 tapestation shotgun sequence perform use illumina hiseq 4000 pairedend 150 bp read library preparation undertake use nebnext ultra ii dna library prep kit 15 dual index barcodes unique end customdesigned order integrate dna technology idt03 quality control prepped library perform use promega glomax03 quantifluor03 dsdna system uniquely dualindexed library pool run single lane hiseq4000 mean 6.89 gb sequence data acquire 120 sample median 6.84 range 3.88 14 gb know laneswapping issue hiseq 4000 lead duplication sequence read reason fastq file sample subject deduplication use fastuniq sequence data process use scalable metagenomics pipeline scamp \<SEP>1