scalex implement generalize encoder enable online integration singlecell data enable online integration fundamental design concept underlie scalex implement generalize projection function disentangle batchrelated component away batchinvariant component singlecell data project batchinvariant component common cellembedding space previously apply vae design scale singlecell atacseq analysis via latent feature extraction model analyze singlecell atacseq data find encoder scale potential disentangle celltyperelated batchrelated feature lowdimensional embed space obtain generalize encoder data projection without retrain scalex include three specific design element fig 1a supplementary fig 1 overview scalex model method first scalex implement batchfree encoder extract biologicalrelated latent feature input singlecell data batchspecific decoder reconstruct original data z incorporate batch information back data reconstruction supply batch information decoder focus encoder exclusively learn batchinvariant biological component crucial encoder generalizability contrast scvi include set batchconditioned parameter encoder restrain encoder generalizability new batch thus preclude online data integration second scalex include domainspecific batch normalization dsbn layer use multibranch batch normalization decoder support incorporation batchspecific variation singlecell data reconstruction third scalex encoder employ minibatch strategy sample data batch instead single batch tightly follow overall distribution input data note minibatch subject batch normalization layer encoder adjust deviation minibatch align overall input distribution conduct extensive analysis scalex hyperparameters also test specific contribution design element implement set scalex testvariants lack individual combination design element evaluate performance singlecell data integration ablation study use testvariants scalex method find design element crucial integration performance scalex importantly combination design element render encoder scalex generalize function capable accurate projection single cell data different batch batchinvariant cellembedding space make scalex truly online data integration method extensively assess basic data integration performance scalex follow evaluative framework propose recent comparative study examine multiple wellcurated scrnaseq datasets include human pancreas eight batch five study heart two batch one study liver two study well human nonsmallcell lung cancer nsclc four study peripheral blood mononuclear cell pbmc two batch assay two different protocol comparison include online inmf stateoftheart nononline singlecell data integration method include seurat v3 harmony mnn conos bbknn scanorama liger i.e. batch inmf scvi evaluate integration performance tool base benchmark datasets uniform manifold approximation projection umap embed visualization well series score metric umap embed note raw datasets display strong batch effect celltypes common different batch separately distribute overall scalex seurat v3 harmony achieve best integration performance datasets merge common celltypes across batch keep disparate celltypes apart supplementary fig 2. mnn scvi conos integrate many datasets leave common celltypes wellaligned online inmf liger bbknn scanorama often unmerged common celltypes sometimes incorrectly mix distinct celltypes together example consider cell population two batch pmbc dataset fig 1b scalex seurat v3 harmony mnn scvi integration effective online inmf misalign cd4 na07ve cell cd8 na07ve cell misalign nk cell cd8 cell scalex substantially outperform method celltype cluster assess adjust rand index ari normalize mutual information nmi fig 1c supplementary fig 3 4. quantify celltype separation batch mix use two pair metric pair comprise silhouette score batch entropy mix score well pair comprise celltype integration local inverse simpson 's index clisi ilisi overall scalex achieve highest score celltype separation tie seurat v3 harmony bestperforming method batch mix metric supplementary fig 4a interestingly observe liger online inmf often score lowest celltype separation yet highest batch mix however careful investigation conclude higher batch mix score necessarily indicate better data integration instead often indicate issue overcorrection consider indepth dedicate subsection finally follow protocol recent largescale study benchmarking singlecell integration method compare scalex ten stateoftheart method use multiple score singlecell integration benchmarking scib method observe scalex outperform tool pancreas liver nsclc datasets term overall score rank third pbmc dataset fourth heart dataset supplementary fig 4b singlecell datasets contain large number cell consist heterogenous complex sample multiple tissue term atlaslevel datasets recent comparative study atlaslevel datasets pose new challenge data integration tool test scalability computation efficiency scalex apply typical atlaslevel dataset human fetal atlas dataset contain 4,317,246 cell two data batch gse156793 gse134355 supplementary fig 5a b preprocessing scrnaseq method scalex accurately integrate two batch show good alignment celltypes fig 1d addition scalex bbknn scanorama scvi use integrate atlaslevel dataset however integration separate align celltypes well indicate umap embeddings supplementary fig 5c low celltype separation batch mix score supplementary fig 5d compare computational efficiency different method use downsampled datasets 10 kilo k 50 k 250 k 1 million 4 cell human fetal atlas dataset scalex online inmf consume efficient runtime memory increase linearly data size scvi also scalable 4 cell acceptable memory usage whereas seurat v3 harmony conos liger consume runtime andor memory increase exponentially thus scale beyond 1 cell workstation 64 central process unit cpu core 256 gigabyte gb memory fig 1e notably deep learn framework scalex enable run efficiently graphic process unit gpu device require much reduce runtime use 20 minute 90 gb memory 4 dataset scalex use integrate modality singlecell data e.g. scatacseq cellular index transcriptomes epitope sequence citeseq etc crossmodality data e.g. simultaneous analysis scrnaseq scatacseq scalex substantially outperform method integration mouse brain scatacseq datasets two batch assay single nucleus assay transposaseaccessible chromatin use sequence snatac 10x fig 1f supplementary fig 6ac perform well integration additional singlecell data modality include citeseq spatial transcriptome merfish data supplementary fig 6d e. also use scalex integrate crossmodality dataset scrnaseq scatacseq find scalex correctly integrate two modality data distinguish rare cell specific scrnaseq data include pdc platelet cell fig 1g better method include two additional method scjoint bindsc accord umap embeddings multiple analytical metric supplementary fig 7. many recent singlecell datasets especially atlaslevel datasets feature high sample heterogeneity complex celltype composition datasets often contain partially overlap batch batch contain nonoverlapping cell population example liver dataset partially overlap dataset hepatocyte population contain multiple subtypes specific different batch three subtypes specific livergse124395 two subtypes appear livergse115469 supplementary fig 8. partial overlap problem present major challenge singlecell data integration often lead issue overcorrection i.e. mix distinct celltypes especially local cell similaritybased method example seurat v3 mix hepatocytecxcl1 hepatocytecyp2a13 hepatocytetatas1 cell harmony mix hepatocytecyp2a13 hepatocytetatas1 cell fig 2a global integration method project cell common cellembedding space scalex expect le sensitive problem indeed notice scalex correctly maintain five hepatocyte subtypes apart scvi fig 2a unexpectedly despite global method online inmf severely suffer overcorrection mix five hepatocyte subtypes even mix b cell nk cell fig 2a presumably matrix factor algorithm force alignment distinct celltypes define overcorrection score metric measure overcorrection problem base percent cell inconsistent celltypes neighborhood cell overcorrection score method formally overcorrection score negative index i.e. higher overcorrection score severe extent inaccurate mix celltypes benchmark datasets scalex lowest overcorrection score fig 2b whereas online inmf yield extremely high overcorrection score systematically characterize performance different method partially overlap datasets construct test datasets range common celltypes generate base downsampling six major celltypes pancreas dataset generation partially overlap datasets method scalex integration accurate case align celltypes without overcorrection whereas seurat v3 harmony online inmf frequently mix distinct celltypes fig 2c d. although scvi show one lowest level overcorrection integrate partially overlap datasets prone mistakenly split one celltype many small group note severity overcorrection errorsplitting amplify overlap number decrease supplementary fig 9. common celltypes seurat v3 harmony collapse six celltypes three mix alpha gamma cell beta delta cell acinar ductal cell vary extent whereas scvi split alpha cell 6 group repeat downsampling analysis 12 celltypes pbmc dataset observe similar result overcorrection errorsplitting supplementary fig 10. generalizability scalex 's encoder project cell various source common cellembedding space without model retrain allow scalex integrate new singlecell data exist data online manner test online data integration performance scalex newly arrive data base pancreas dataset prior projection first use scalex integrate pancreas dataset accurately remove strong batch effect evident raw data fig 3a supplementary fig 11a b. subsequently project three new batch scrnaseq data pancreas tissue fig 3b pancreas cell space use scalex encoder train original pancreas dataset projection cell new batch accurately align correct celltypes pancreas cell space enable accurate annotation celltype label transfer fig 3c celltype annotation label transfer method benchmarked projection accuracy calculate ari nmi f1 score evaluate celltype annotation label transfer celltype information original study compare result online inmf scvi two tool able project cell exist cellspace note data projection scvi need model retrain scarches scalex achieve highest projection accuracy comparison online inmf scvi fig 3c scvi also achieve high accuracy project cell onto right location exception alpha ductal cell supplementary fig 11c online inmf mix distinct celltypes incorporate new batch e.g. project alpha cell onto location gamma delta cell supplementary fig 11c turn lead wrong annotation label transfer fig 3c ability project new singlecell data exist cellembedding space allow scalex readily enrich i.e. add biological resolution cell space additional informative detail verify project two additional melanoma data batch skcmgse72056 skcmgse123139 onto previously construct pbmc space scalex correctly project common celltypes onto location pbmc cell space fig 3d online inmf mix tumor cell plasma monocyte cd8 cell scvi split cd8t cell several distinct group supplementary fig 12. importantly notice tumor plasma cell present melanoma data batch scalex project cell onto exist cell population pbmc space rather project onto new location close similar cell plasma cell project location near b cell tumor cell project location near hsc cell fig 3e indicate scalex enrich exist cell space new celltypes data projection scalex projection also enable post hoc annotation unknown celltypes exist cell space use new data instance note group previously uncharacterized cell pancreas dataset fig 3a find cell display high expression level know epithelial gene marker therefore assemble collection epithelial cell bronchial epithelium dataset project epithelial cell onto pancreas cell space find group antigenpresenting airway epithelial slc16a7 epithelial cell project onto location uncharacterized cell fig 3f data together observation cell population show similar marker gene expression fig 3g suggest uncharacterized cell also slc16a7 epithelial cell note online inmf scvi able identify small group epithelial cell split several smaller group andor often mix celltypes supplementary fig 2. scalex thus enable discovery science cell biology support exploratory analysis large number diverse datasets ability combine heterogenous data common cellembedding space make scalex powerful tool construct singlecell atlas collection diverse datasets apply scalex integration three large complex datasets mouse atlas dataset comprise multiple organ two study assay 10x smartseq2 microwellseq human atlas dataset comprise multiple organ two study assay 10x microwellseq human fetal atlas dataset supplementary fig 13. despite strong batch effect raw data scalex accurately integrate three batch mouse atlas data common cellembedding space fig 4ac supplementary fig 14a common celltypes wellaligned position cell space include b endothelial cell present tissue proximal tubule urothelial hepatocytic cell particular tissue distinct celltypes locate separately sperm leydig small intestine cell microwellseq data keratinocyte stem cell large intestine cell smartseq2 data indicate biological variation well preserve supplementary fig 14b c. compare scalex method find scalex perform best celltype cluster especially avoid overcorrection fig 4d e supplementary fig 13b importantly atlas generate scalex expand project new singlecell data support comparative study cell original atlas new data illustrate utility project two additional data batch age mouse tissue tabula muris senis smartseq2 10x two single tissue datasets lung kidney onto scalex mouse atlas cell space find cell new data batch correctly project onto location celltypes cellembedding space initial atlas fig 4f confirm accurate celltype annotation new data label transfer fig 4g follow strategy construct scalex human atlas integration multiple tissue two study gse134355 gse159929 supplementary fig 15a b. scalex effectively eliminate batch effect original data integrate two datasets supplementary fig 15c d. able correctly project two additional human skin datasets gse130973 gse147424 onto human atlas cell space supplementary fig 15e accurately annotate project skin cell supplementary fig 15f sum result illustrate scalex enable researcher evaluate projectspecific single cell datasets leverage exist information largescale ostensibly well annotate cell atlas ii atlas creator informatively integrate new datasets derive new biological insight new research program many singlecell study conduct analyze covid19 patient immune response however study often suffer small sample size andor limit sample various disease state comprehensive study use scalex generate covid19 pbmc atlas integrate data nine covid19 study involve total 860,746 single cell 10 batch fig 5a supplementary dataset 1. identify 22 celltypes support gene expression data canonical marker fig 5b c supplementary fig 16a celltype annotation cluster method cell across different study integrate accurately celltypes align together confirm integration performance scalex supplementary fig 16b much better method supplementary fig 16c d. interestingly find cell subpopulation differentially associate patient status fig 5d subpopulation cd14 monocyte cd14isg15mono characterize high expression type interferonstimulated gene isgs gene enrich immuneresponserelated gene ontology go term fig 5e f. frequency cd14isg15mono cell increase significantly mildmoderate severe patient fig 5g supplementary fig 17a analysis change celltype frequency across multiple condition method within covid19 patient observe significant decrease isg gene expression cd14isg15mono cell mildmoderate severe case suggest immune exhaustionlike response severe covid19 patient fig 5e additionally neutrophil subpopulation ncf1immatureneutrophil characterize decrease expression gene responsible neutrophil activation elevate expression gene enrich viralprocessrelated go term specifically enrich severe verse mildmoderate patient supplementary fig 17b c. plasma cell subpopulation mzb1plasma characterize decrease expression gene relate antibody production enrich immune inflammatory responserelated go term also enrich severe patient supplementary fig 17d e. thus scalex covid19 pbmc atlas generate integrate highly diverse collection singlecell data individual study identify multiple immune celltypes become progressively dysfunctional covid19 disease progression importantly cell trend could detect smallscale individual study serve basis scalex covid19 pbmc atlas analysis base scalex covid19 pbmc atlas yield find consistent two conclusion single cell consortium covid19 china sc4 study recent largescale effort generate singlecell atlas 1 million cell 171 covid19 patient 25 healthy control supplementary fig 18a first study observe set immune cell subpopulation display differential association covid19 severity proportion cd14 monocyte megakaryocyte plasma cell pro cell elevate increase disease severity proportion pdc mdc cell decrease fig 5g second base calculate cytokine score inflammatory score define sc4 study cell scalex covid19 pbmc atlas confirm monocyte subpopulation associate cytokine storm trigger sarscov2 infection elevate severe patient fig 5j inflammatory cytokine score analysis method adjust pvalue 0.01. scalex 's online integration capacity enable u project sc4 consortium dataset cell space scalex covid19 pbmc atlas find celltypes two atlas wellaligned fig 5h supplementary fig 18b c. integration sc4 data substantially improve scope resolution scalex covid19 pbmc atlas first data add macrophage epithelial cell cell space enable investigation potential involvement covid19 integration also support precise characterization specific cell subpopulation example megakaryocyte population distinguish either scalex covid19 pbmc atlas sc4 atlas supplementary fig 16c divide two subpopulation combine atlas projection sc4 fig 5h exploratory functional analysis differentially express gene two newly delineate megakaryocyte subpopulation tuba8mega igkcmega supplementary fig 18d e reveal enrichment go term humoral immune response igkcmega cell yet enrichment negative regulation platelet activation tuba8mega cell fig 5k result illustrate continuously expandable singlecell atlas generate use scalex capitalize exist largescale data resource also facilitate discovery new biological biomedical \<SEP>0